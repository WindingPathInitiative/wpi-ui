<ng-container *ngIf="orgUnit">
	<div *ngIf="userOffices && userOffices.length">
		<span>Viewing as office:</span>
		<span *ngIf="userOffices.length==1 || editing">{{userOffices[0].name}}</span>
		<select *ngIf="userOffices.length>1 && !editing" [(ngModel)]="selectedOffice" (change)="officePermissions(selectedOffice)">
			<option *ngFor="let officeOption of userOffices" [ngValue]="officeOption">{{officeOption.name}}</option>
		</select>
	</div>
	<h1>Location: {{orgUnit.name}}</h1>
	<button type="button" class="btn btn-primary" *ngIf="!editing && selectedOffice?.roles && selectedOffice.roles.indexOf('org_update') !== -1" (click)="editOrg()">Edit</button>
	<div *ngIf="!editing">
		<ul style="list-style-type: none;">
			<li><label>Code:</label> <span>{{orgUnit.code}}</span></li>
			<li><label>Name:</label> <span>{{orgUnit.name}}</span></li>
			<li><label>Location:</label> <span>{{orgUnit.location}}</span></li>
			<li><label>Type:</label><span>{{orgUnit.type}}</span></li>
			<li><label>Website:</label> <span><a [href]="orgUnit.website" target="_blank">{{orgUnit.website}}</a></span></li>
			<li *ngIf="orgUnit.parents && orgUnit.parents.length"><label>Parent Location:</label> <span><a [routerLink]="['/locations',orgUnit.parents[0].id]">{{orgUnit.parents[0].name}} ({{orgUnit.parents[0].code}})</a></span></li>
		</ul>
		<p>{{orgUnit.defDoc}}</p>
	</div>
	<div *ngIf="editing">
		<label>Code:</label> <input type="text" [(ngModel)]="editOrgUnit.code"/><br/>
		<label>Name:</label> <input type="text" [(ngModel)]="editOrgUnit.name"/><br/>
		<label>Location:</label> <input type="text" [(ngModel)]="editOrgUnit.location"/><br/>
		<label>Website:</label> <input type="text" [(ngModel)]="editOrgUnit.website"/><br/>
		<label>Description</label> <textarea [(ngModel)]="editOrgUnit.defDoc"></textarea><br/>
		<button type="button" class="btn btn-primary" (click)="saveOrg()">Save</button>
		<button type="button" class="btn btn-secondary" (click)="cancelOrg()">Cancel</button>
	</div>
	<div><h1>Officers</h1>
		<span *ngIf="!orgUnit.offices || orgUnit.offices.length == 0">None!</span>
		<ul style="list-style-type: none;" *ngIf="orgUnit.offices.length">
			<li *ngFor="let office of orgUnit.offices">
				<span>{{office.name}} ({{office.type}}):</span>
				<span *ngIf="!office?.user?.membershipNumber">Vacant</span>
				<span *ngIf="office?.user?.membershipNumber"><a [routerLink]="['/members',office.user.id]">{{office.user.nickname}} ({{office.user.membershipNumber}})</a></span>
				<span *ngIf="office.email">Email: <a href="mailto:{{office.email}}">{{office.email}}</a></span>
			</li>
		</ul>
	</div>
	<div>
		<h1>Locations in {{orgUnit.name}}</h1>
		<span *ngIf="!orgUnit.children || orgUnit.children.length == 0">None!</span>
		<ul style="list-style-type: none;" *ngIf="orgUnit.children?.length">
			<li *ngFor="let childUnit of orgUnit.children">
				<span><a [routerLink]="['/locations',childUnit.id]">{{childUnit.name}} ({{childUnit.code}})</a></span>
			</li>
		</ul>
		<button type="button" class="btn btn-primary" *ngFor="let addOrgType of canAddOrgs" (click)="addOrgModal(addTemplate,addOrgType)">Add {{addOrgType}}</button>
	</div>
	<div><h1>Members</h1>
		<span *ngIf="!orgUnit.users || orgUnit.users.length == 0">None!</span>
		<ul style="list-style-type: none;" *ngIf="orgUnit.users.length">
			<li *ngFor="let member of orgUnit.users">
				<span><a [routerLink]="['/members',member.id]">{{member.nickname}} ({{member.membershipNumber}})</a></span>
			</li>
		</ul>
	</div>
</ng-container>
<ng-template #addTemplate>
	<ng-container *ngIf="orgModel">
		<div class="modal-header">
			<h4 class="modal-title pull-left">Add New {{orgModel.type}}</h4>
			<button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
			<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="modal-body">
			<label>Code:</label> <input type="text" [(ngModel)]="orgModel.code" required/><br/>
			<label>Name:</label> <input type="text" [(ngModel)]="orgModel.name" required/><br/>
			<label>Location:</label> <input type="text" [(ngModel)]="orgModel.location" required/><br/>
			<label>Website:</label> <input type="text" [(ngModel)]="orgModel.website"/><br/>
			<label>Description</label> <textarea [(ngModel)]="orgModel.defDoc"></textarea><br/>
			<button type="button" class="btn btn-primary" (click)="addOrg()">Add</button>
			<button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Cancel</button>
		</div>
	</ng-container>
</ng-template>